\documentclass[12pt]{article}

\usepackage{sbc-template}
\usepackage{listings}
\usepackage{float}

\usepackage{graphicx,url}

\usepackage[brazil]{babel}   
\usepackage[latin1]{inputenc}  
\usepackage{textcomp}

     
\sloppy

\title{Data Warehouses:\\ HP Vertica e armazenamento colunar}

\author{Athos C. Ribeiro\inst{1}, Karoline Bonome\inst{2}, Márcio Stabile\inst{1} }


\address{Departamento de Ciência da Computação, \\
  Instituto de Matemática e Estatística, Universidade de São Paulo
\nextinstitute
  Departamento de Informática em Saúde\\
  Escola Paulista de Medicina, Universidade Federal de São Paulo
  \email{\{athoscr,mstabile\}@ime.usp.br, kbonome@gmail.com}
}

\setlength\floatsep{2.25\baselineskip plus 3pt minus 2pt}
\setlength\textfloatsep{2.25\baselineskip plus 3pt minus 2pt}
\setlength\intextsep{2.25\baselineskip plus 3pt minus 3 pt}
\begin{document} 

\maketitle

%\begin{abstract}
%  Do we need an abstract here? I think we do!
%\end{abstract}
%     
%\begin{resumo} 
%  Precisamos de um resumo aqui? Acho que sim!
%\end{resumo}


\section{Motivação} % Contextualização e motivação do tema

%Aqui diria por que Data Warehouses são legais \cite{kimball2011data}


De acordo com \cite{Elmasri1999}, o crescente poder de processamento e a sofisticação das ferramentas e técnicas analíticas resultaram no desenvolvimento das \textit{data warehouses}. \textit{Data warehouses} comumente oferecem armazenamento, funcionalidades e responsividade a consultas de um modo que não pode ser realizado em bancos de dados relacionais orientados a transação. Além disso, possuem seu foco em proporcionar informações que sejam úteis a usuários responsáveis por atividades gerenciais, dando suporte à tomada de decisões. Além disso, segundo \cite{Takecian2014}, com o passar dos anos houve um grande crescimento do número de aplicações que necessitam integrar dados provenientes de diversas fontes distintas e muitas vezes o modelo que mais se encaixava na resolução dos problemas de integração de dados é a utilização de um \textit{data warehouse}.

\section{Conceitos básicos} \label{sec:firstpage} %Principais conceitos relacionados ao tema

%Dar uma explicada com base no livro de Data Warehouse o que são elas. \cite{Inmon1992}

Apesar de não haver uma definição única para o que é um \textit{data warehouse}, \cite{Inmon1992} a define como uma coleção de dados orientada a assunto, integrada, não volátil e variável no tempo para o suporte às decisões de gerência. 

A primeira característica de uma \textit{data warehouse} é a orientação a assuntos. Nela é dito que cada tipo de empresa possui seu próprio conjunto de assuntos de interesse, assim, a \textit{data warehouse} deve ser específica e espelhar o domínio de aplicação da organização que a usa.

A segunda principal característica das \textit{data warehouses} é a integração. Como os dados contidos em uma \textit{data warehouse} são provenientes de múltiplas fontes, frequentemente existem diferenças em como os mesmos dados são representados em cada sistema de origem, como ilustra a figura \ref{fig:integracao}, tornando necessária a execução de operações como conversão, re-formatação e re-sequenciamento para que só então os dados sejam armazenados dentro da estrutura da \textit{data warehouse}.

A não volatilidade define que diferentemente dos SGBDs convencionais onde os dados são acessados e manipulados frequentemente em pequenas quantidades, os dados de uma \textit{data warehouse} são carregados e acessados em massa e não são atualizados. Quando dados são carregados, esse carregamento é feito através de \textit{snapshots} e quando ocorrem alterações nos dados, um novo \textit{snapshot} é carregado, mantendo o histórico dos dados armazenados.

A última característica das \textit{data warehouses} é a variação no tempo. Variação de tempo implica que cada unidade de dados na \textit{data warehouse} é válida em algum um momento no tempo. Em alguns casos, um registro possui um carimbo de tempo. Em outros casos, um registro tem uma data de transação. Mas, em todos os casos, existe alguma forma de marcação de tempo para exibir o momento no tempo no qual o registro é válido.

\begin{figure}[ht]
\centering
\includegraphics[width=.99\textwidth]{images/integracao.png}
\caption{Problemas de integração. \cite{Inmon1992}.}
\label{fig:integracao}
\end{figure}

%ETL
%\textit{Extract-Transform-Load} (ETL)
% Dado que as diferentes informações de um DWH vêm de fontes diferentes, é necessários que se integrem tais fontes...

%OLAP
%\textit{On-Line Analytical Processing} (OLAP)

%ROLAP vs MOLAP vs HOLAP

%CUBOS

\section{Estado da arte} %Descrição do estado da arte de trabalhos teóricos e também de ferramentas de software relacionadas ao tema
%Falar as ferramentas que existem, mostrar o SpagoBI, o Vertica e talvez algum outro se achar artigos

Até alguns anos atrás, o uso industrial de ferramentas \textit{open source} para \textit{Business Intelligence} ainda não era tão abrangente quanto o uso de ferramentas proprietárias. Ferramentas ETL ainda não eram maduras o suficiente e ferramentas OLAP não eram tão robustas para uso comercial. Em geral, um dos maiores problemas encontrados para a maior parte das ferramentas era a falta de documentação apropriada. \cite{thomsen2005survey}.

A crescente demanda por ferramentas de \textit{Business Intelligence} tem atraído diversas empresas para esta área, como é possível ver na tabela \ref{tab:tools}. Isto também tem acontecido no mundo de ferramentas Livres, onde diversas soluções interessantes têm surgido nos últimos anos \cite{gioia2008spagobi}. Dentre tais ferramentas, duas que têm se destacado nos últimos anos são a Pentaho, com um sistema de licença Livre e comercial, onde a última adiciona módulos proprietários, documentação e serviços à ferramenta, e a SpagoBI, com uma filosofia totalmente Livre (sem versões comerciais).

\begin{table}[]
\centering
\begin{tabular}{|l|l|c|c|c|}
\hline
\multicolumn{1}{|c|}{\textbf{Nome}} & \multicolumn{1}{c|}{\textbf{Empresa}} & \textbf{Licença} & \textbf{\begin{tabular}[c]{@{}c@{}}Rank\\ DB-Engines\end{tabular}} & \textbf{Armazenamento} \\ \hline
Microsoft Analytics & Microsoft & Pago & - & Não informado \\ \hline
Oracle Data Warehouse & Oracle & Pago & - & Não informado \\ \hline
IMB dashDB & IBM & Pago & 113 & \begin{tabular}[c]{@{}c@{}}Armazenamento\\ Colunar e por Linhas\end{tabular} \\ \hline
Amazon Redshift & Amazon & Pago & 37 & \begin{tabular}[c]{@{}c@{}}Armazenamento\\ Colunar\end{tabular} \\ \hline
Mondrian & Hitachi & Community & - & Hybrid OLAP \\ \hline
Vertica & HP & Community & 30 & \begin{tabular}[c]{@{}c@{}}Armazenamento\\ Colunar\end{tabular} \\ \hline
Spago BI & - & Livre & - & ROLAP + Mondrian \\ \hline
\end{tabular}
\caption{Ferramentas para Data Warehouse}
\label{tab:tools}
\end{table}

\subsection{Ferramentas}

\subsubsection{Mondrian}

Mondrian, que é parte do projeto Pentaho\footnote{\url{pentaho.com}}, é um servidor OLAP implementado em Java orientado a ROLAP e pode ser utilizado com qualquer SGBD que possua um \textit{driver} JDBC \cite{thomsen2005survey}. Licenciado sob \textit{Eclipse Public License 1.0}\footnote{\url{http://www.eclipse.org/legal/epl-v10.html}}, o Mondrian é uma ferramenta livre. A documentação\footnote{\url{http://mondrian.pentaho.com/documentation}} da ferramenta afirma que ela é capaz de trabalhar com conjuntos de dados de tamanho significativo, desde que o SGBD seja capaz de trabalhar com tal conjunto de dados, dado que as agregações são realizadas pelos SGBDs.

Mondrian executa consultas escritas em linguagem MDX (\textit{Multi-Dimentional Expressions})\footnote{linguagem introduzida pela Microsoft em 1998, posteriormente proposto como padrão pela empresa, aumentando sua adoção em meio a desenvolvedores de aplicações} e apresenta resultados em um formato multidimensional\footnote{Embora os formatos sejam apresentados em formato multidimensional, os mesmos são armazenados em formato relacional} através de uma API em Java. A ferramenta utiliza cubos particionados, permitindo diversas tabelas de fatos (um cubo particionado possui diversas tabelas de fatos).

\begin{lstlisting}[caption=Exemplo de consulta em MDX]
SELECT {[Measures].[Unit Sales], [Measures].[Store Sales]}
    ON COLUMNS, {[Product].members} ON ROWS
FROM [Sales]
WHERE [Time].[1997].[Q2] 
\end{lstlisting}

A arquitetura da ferramenta é definida em 4 camadas e pode ser vista na figura \ref{fig:mondrian}:

\begin{itemize}
  \item Camada de apresentação
  \item Camada dimensional
  \item Camada estrela (\textit{Star Layer})
  \item Camada de armazenamento
\end{itemize}

A \textbf{camada de apresentação} determina como o usuário visualiza e interage com os dados. Na \textbf{camada dimensional}, as consultas em MDX são avaliadas e executadas. A \textbf{camada estrela} é responsável por manter as agregações em cache, quando a camada dimensional envia requisições e as agregações requisitadas não possuem e nem podem derivar os conjuntos de valores requisitados, uma requisição à \textbf{camada de armazenamento} é realizada. Esta camada é composta por um SGBD relacional.

\begin{figure}[ht]
\centering
\includegraphics[width=.99\textwidth]{images/mondrian_arch.png}
\caption{Arquitetura: Mondrian. Fonte: mondrian.pentaho.com}
\label{fig:mondrian}
\end{figure}

\subsubsection{SpagoBI}

SpagoBI é uma plataforma completa de integração para \textit{Business Intelligence}, cobrindo toda a extensão de necessidades de análise, incluindo ETL, OLAP e \textbf{data mining}. Esta integração é feita através de \textit{engines}, possibilitando que o usuário escolha quais ferramentas devem compor sua plataforma \cite{gioia2008spagobi}. As ferramentas que compõem os diversos módulos da SpagoBI podem ser parte do projeto SpagoBI, ferramentas de outros projetos de Licenças Livres ou variações de tais projetos. \cite{golfarelli2009open}

A arquitetura da ferramenta é definida em 3 camadas que podem ser vistas na figura \ref{fig:spagoBI}:

\begin{itemize}
  \item Camada de entrega
  \item Camada analítica
  \item Camada de dados e metadados
\end{itemize}

\begin{figure}[ht]
\centering
\includegraphics[width=.99\textwidth]{images/spagoBI_arch.png}
\caption{Arquitetura: SagoBI. Fonte: wiki.spagobi.org}
\label{fig:spagoBI}
\end{figure}

\section{HP Vertica Analytics Platform}%Um pouco mais de detalhes de ao menos uma ferramenta escolhida para ilustrar a implementação de conceitos abordados no trabalho

A plataforma analítica HP Vertica compreende um conjunto de ferramentas projetadas para lidar com as demandas atuais ligadas à análise de grandes volumes de dados para extração de informações gerenciais. Trata-se, essencialmente, de um sistema gerenciador de banco de dados relacional, que além das características de sistemas tradicionais, como as transações ACID, a linguagem de consulta padronizada (SQL) e a segurança, ainda apresenta uma série de otimizações que permitem a construção e a manipulação de data warehouses de maneira eficiente. \cite{Bear2012}

Baseado no projeto de código aberto C-Store, proposto por \cite{Stonebraker2005}, o Vertica tem como principais características os chamados ``Quatro C's'', descritos por \cite{Lamb2012}.

\begin{itemize}
\item \textbf{Armazenamento colunar} (Columnar Storage)
\item \textbf{Compressão e codificação dos dados} (Compression and Encoding)
\item \textbf{Arquitetura distribuída} (Clustering)
\item \textbf{Performance contínua} (Continuous Performance).
\end{itemize}

\subsection{Armazenamento Colunar}

Sistemas gerenciadores de bancos de dados tradicionais são comumente projetados em uma arquitetura voltada a cargas de trabalho transacionais (write-optimized), na qual é executado um grande número de transações por segundo envolvendo a inserção ou modificação de tuplas no banco de dados. Neste modelo, os dados são armazenados em disco uma linha (tupla) após a outra, ou seja, cada registro com todos os valores de atributos que compõem uma relação.

Em aplicações cujo caráter é fundamentalmente analítico, as operações transacionais dão lugar ás operações de leitura de grandes conjuntos de registros (como no caso dos data warehouses), sendo necessária uma arquitetura otimizada para estes processos (read-optimized). Assim, sistemas como estes podem se beneficiar do armazenamento colunar, utilizado pela plataforma Vertica.

Nesta arquitetura, os valores de cada coluna que compõe as relações no banco de dados são armazenados separadamente no disco. Dessa forma, é preciso fazer a leitura somente das colunas requeridas pela consulta, conferindo maior eficiência em menos tempo. Na proposta do projeto C-Store, implementada pelo Vertica, um conjunto de colunas é armazenado de forma ordenada por algum atributo e comprimida. Este processo será melhor explorado nas subseções a seguir.

Vertica conta ainda com a tecnologia FlexStore\texttrademark, um mecanismo que combina técnicas de projeto físico, armazenamento de bancos de dados e execução de consultas para otimizar a arquitetura colunar do sistema. Estas técnicas incluem o agrupamento de colunas, em que as colunas correlacionadas ou que são sempre consultadas juntas são armazenadas próximas, e o uso inteligente do disco, que reorganiza as cargas de trabalho quando discos de estado sólido (SSD) e discos rígidos (HD) estão disponíveis.

\subsection{Compressão e Codificação dos Dados}

Para melhor performance de consulta e economia de espaço de armazenamento, Vertica aplica métodos robustos de compressão e codificação dos valores contidos em cada coluna, os quais se beneficiam da ordenação dos valores. A depender do tipo de dado, o sistema emprega uma das seguintes técnicas de codificação:

\begin{itemize}
\item \textbf{Automática:} método padrão. O sistema automaticamente escolhe o tipo de codificação mais vantajosa, com base nas propriedades dos dados;
\item \textbf{Run Length Encoding (RLE):} aplicado a colunas ordenadas e de baixa cardinalidade, substitui sequências repetidas de valores por uma única ocorrência contendo o valor e o número de vezes em que ele ocorre;
\item \textbf{Valor Delta:} melhor empregado em colunas de inteiros, ordenados e não ordenados, de alta cardinalidade. Os valores são armazenados como a diferença entre o valor anterior no bloco considerado;
\item \textbf{Dicionário de Blocos:} para colunas desordenadas com poucos valores distintos, neste caso é criado um dicionário com todos os valores da coluna e estes são substituídos por uma referência ao dicionário construído.
\end{itemize}

Além da codificação, Vertica comprime os dados armazenados nas colunas através do algoritmo LZO\footnote{\url{http://www.oberhumer.com/opensource/lzo/}}. Com isto, a limitação imposta pela disponibilidade de espaço para armazenamento pode ser superada, já que é possível armazenar uma quantidade muito maior de dados comprimidos (as taxas de compressão variam de 50\% a 90\%). Vale ressaltar que estas taxas de compressão são possíveis devido à otimização do armazenamento, que aloca colunas de mesmo tipo de dado juntas no disco. Entretanto, estes dados dever ser descomprimidos para processamento.

\subsection{Arquitetura Distribuída}

Vertica foi projetado para execução em uma arquitetura \textit{shared-nothing} utilizando servidores Linux \textit{commodity} conectados. Baseado nos princípios do \textit{Massively Parallel Processing} (MPP) associados ao armazenamento colunar, o sistema é capaz de armazenar os dados em clusters, em que cada nó contém uma \textbf{projeção} da tabela original (Figura \ref{fig:vertica1}).

\begin{figure}[ht]
\centering
\includegraphics[width=.99\textwidth]{images/vertica1.png}
\caption{Representação das projeções utilizadas pela plataforma HP Vertica\textregistered. Estraído de \cite{Lamb2012}}
\label{fig:vertica1}
\end{figure}

Uma projeção é um subconjunto ordenado de atributos (colunas) das tabelas originais no banco de dados. Assim, podem haver diversas projeções com números variados de atributos, as quais podem ser pensadas como visões materializadas do banco de dados. Cada projeção é ordenada segundo um determinado atributo e uma coluna pode estar presente em mais de uma projeção (sobreposição).

Para garantir tolerância a falhas e alta disponibilidade, Vertica se utiliza da redundância dos dados ao longo dos nós do cluster. Através da tecnologia K-Safety (Figura \ref{fig:vertica2}), o usuário determina quantas réplicas das projeções existirão (que podem ser 0, 1 ou 2), garantindo que se um nó do cluster estiver indisponível, os processamentos prosseguirão utilizando a réplica disponível em outro nó (o chamado \textit{buddy projection}).

\begin{figure}[H]
\centering
\includegraphics[width=.99\textwidth]{images/vertica2.png}
\caption{Representação do mecanismo K-Safety. Em A todos os cinco nós estão funcionando corretamente com um nível K-Safety = 1. Assim, cada nó contém uma buddy projection do próximo nó. Em B, o nó 2 falha, mas o banco de dados continua executando corretamente, já que o nó 1 contém sua buddy projection. Neste caso, os nós 1 e 3 tornam-se nós críticos, pois se houver falha em um ou nos dois, o banco de dados será inseguro. Extraído de HP Vertica Analytics Platform Version 7.2.x Documentation.}
\label{fig:vertica2}
\end{figure}

\subsection{Performance Contínua}

Na plataforma Vertica não é necessário interromper as atividades do banco de dados para a execução de atualizações nos dados. É possível consultar e carregar dados simultaneamente, e fazer alterações no esquema do banco de dados sem torná-lo indisponível.

Isto é possível graças ao modelo de armazenamento híbrido com duas camadas de dados: a \textit{Read Optimized Store} (ROS) e a \textit{Write Optimized Store} (WOS). A primeira é altamente otimizada e orientada a leitura dos dados, armazenada no disco. Esta partição faz uso massivo da compressão e indexação dos dados. Já a partição WOS é uma estrutura residente na memória que comporta dados carregados ao \textit{data warehouse}. Os dados armazenados na WOS não são comprimidos ou indexados para que o carregamento seja feito rapidamente.

Entre estas camadas, há um terceiro componente, o \textit{Tuple Mover} (TM), responsável por mover os dados da camada WOS para o disco, na camada ROS. Ele também combina pequenos repositórios de dados à projeção armazenada além de remover permanentemente as tuplas deletadas. Esta estrutura está representada na Figura \ref{fig:vertica3}.

\begin{figure}[H]
\centering
\includegraphics[width=.99\textwidth]{images/vertica3.png}
\caption{Representação das camadas de armazenamento de dados ROS e WOS. Extraído de  HP Vertica Analytics Platform Version 7.2.x Documentation.}
\label{fig:vertica3}
\end{figure}

  Além dos recursos anteriores, a plataforma Vertica possui capacidade de integração com ferramentas como Apache Hadoop\footnote{\url{https://hadoop.apache.org/}}, Apache Kafka\footnote{\url{http://kafka.apache.org/}} e Informatica PowerCenter\footnote{\url{https://www.informatica.com/}} e suporte a linguagens de programação como o R, o Java e o C++. É oferecida, ainda, uma ferramenta para manipulação de dados espaciais, o HP Vertica Place, cujas funções obedecem ao padrão OGC (\textit{Open Geospatial Consortium}).

  Todo o processamento pode ser feito através de consultas analíticas utilizando a linguagem SQL no padrão de 1999. Estão disponíveis uma série de funções de agregação e para cálculos estatísticos. É possível também utilizar extensões da SQL que dão suporte à análise de séries temporais.

  A plataforma Vertica pode ser manipulada de duas formas: 1) através do \textit{Management Console} (MC), uma interface web que permite criar, importar ou conectar a um banco de dados, gerenciar os clusters e nós, monitorar a performance e a execução do sistema, entre outras funções; 2) através da \textit{Administration Tools}, interface em linha de comando que executa as mesmas funções do MC além de executar tarefas administrativas.

  Estas e muitas outras informações estão disponíveis na documentação oficial da plataforma, em versão online ou para download\footnote{\url{https://my.vertica.com/hpe-haven-documentation/hpe-vertica-analytics-platform-7-2-x-product-documentation/}}.

\section{Conclusão}

O volume crescente de dados disponíveis nos ambientes corporativos gerou a necessidade de haver recursos e ferramentas capazes de extrair informações que possam apoiar o processo de tomada de decisão. Neste contexto, os \textit{data warehouses} tornaram-se a abordagem de escolha para execução de processamentos analíticos de forma otimizada em grandes quantidades de dados, e assim surgiram diversas soluções de software com este propósito.

Dentre as ferramentas disponíveis, a maior parte consiste em extensões de plataformas já existentes (como os sistemas gerenciadores de bancos de dados Oracle e Microsoft SQL Server) com licenças proprietárias. Software Livres normalmente demandam a utilização de mais de uma ferramenta para construção de um ambiente analítico completo, o que pode vir a se tornar um inconveniente para o usuário final ou administradores de sistema menos experiêntes.

Sendo assim, conclui-se que a plataforma analítica HP Vertica\textregistered, objeto de discussão do presente estudo, oferece recursos para a criação de um ambiente altamente otimizado para construção e manipulação de \textit{data warehouses} robustos. Além disso, é uma plataforma versátil que dá ao usuário a alternativa de utilizar suas próprias funcionalidades ou integrá-lo a ferramentas externas para execução de tarefas isoladas, como o processo ETL (\textit{Extract, Transform and Load}). Ainda que seja um software proprietário, a essência inicial de ser um projeto acadêmico persiste na versão Community da plataforma, que disponibiliza todos os recursos oferecidos pelo HP Vertica\textregistered com algumas restrições de uso.

%\begin{figure}[ht]
%\centering
%\includegraphics[width=.5\textwidth]{fig1.jpg}
%\caption{A typical figure}
%\label{fig:exampleFig1}
%\end{figure}

%\begin{figure}[ht]
%\centering
%\includegraphics[width=.3\textwidth]{fig2.jpg}
%\caption{This figure is an example of a figure caption taking more than one
  %line and justified considering margins mentioned in Section~\ref{sec:figs}.}
%\label{fig:exampleFig2}
%\end{figure}

%\begin{table}[ht]
%\centering
%\caption{Variables to be considered on the evaluation of interaction
  %techniques}
%\label{tab:exTable1}
%\includegraphics[width=.7\textwidth]{table.jpg}
%\end{table}


\bibliographystyle{sbc}
\bibliography{datawarehouse}

\end{document}
